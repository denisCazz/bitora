---
import Layout from '../../layouts/Layout.astro';
import NeonCircles from '../../components/NeonCircles.astro';
---

<Layout
  title="Calcolatore ROI Gestionale Professionale per le Aziende | Bitora"
  description="Calcola il ROI di un gestionale professionale per le aziende in base a rapportini, operatori, tempi e costi operativi."
>
  <main class="bg-black text-white overflow-x-hidden selection:bg-indigo-500 selection:text-white">
    <section class="relative py-20 md:py-28 px-6 md:px-12 border-b border-white/5 overflow-hidden">
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] from-indigo-900/20 via-black to-black opacity-70"></div>
      <NeonCircles variant="hero" colors={['blue', 'orange']} />

      <div class="relative z-10 max-w-6xl mx-auto text-center space-y-6">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-indigo-500/10 border border-indigo-500/20 text-sm text-indigo-300">
          <span>ðŸ“ˆ</span> Tool operativo
        </div>
        <h1 class="text-4xl md:text-6xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-white/70">
          Calcolatore ROI â€” Gestionale Professionale per le Aziende
        </h1>
        <p class="text-lg md:text-xl text-gray-300 max-w-4xl mx-auto leading-relaxed">
          Stima in pochi secondi il ritorno economico legato alla digitalizzazione dei rapportini tecnici.
          Inserisci i tuoi dati reali su volumi, tempi e costi per ottenere un ROI mensile e annuale.
        </p>
      </div>
    </section>

    <section class="py-14 md:py-20 px-6 md:px-12 border-b border-white/5">
      <div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-8">
        <article class="rounded-3xl border border-white/10 bg-white/[0.03] p-6 md:p-8">
          <h2 class="text-2xl md:text-3xl font-bold mb-6">Dati operativi</h2>

          <div class="grid gap-5">
            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Operatori coinvolti</span>
              <input id="operators" type="number" min="1" value="6" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>

            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Media interventi per operatore al giorno</span>
              <input id="avgInterventionsPerDay" type="number" min="0.1" step="0.1" value="1.4" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>

            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Rapportini al mese</span>
              <input id="reportsPerMonth" type="number" min="1" value="180" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              <span class="text-xs text-gray-500">Calcolato automaticamente su 22 giorni lavorativi/mese, ma puoi modificarlo manualmente.</span>
            </label>

            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Tempo medio attuale per rapportino (minuti)</span>
              <input id="timeCurrent" type="number" min="1" value="30" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>

            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Tempo medio con gestionale (minuti)</span>
              <input id="timeWithSoftware" type="number" min="1" value="12" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>

            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Costo orario medio operatore (â‚¬)</span>
              <input id="hourlyCost" type="number" min="1" value="28" step="0.5" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>

            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Costo mensile software (â‚¬)</span>
              <input id="softwareMonthly" type="number" min="0" value="690" step="1" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>

            <label class="space-y-2 block">
              <span class="text-sm text-gray-300">Costo di avvio una tantum (â‚¬)</span>
              <input id="setupCost" type="number" min="0" value="7500" step="10" class="w-full bg-black/40 border border-white/15 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>
          </div>
        </article>

        <article class="rounded-3xl border border-white/10 bg-white/[0.03] p-6 md:p-8">
          <h2 class="text-2xl md:text-3xl font-bold mb-6">Risultato ROI</h2>

          <div class="grid sm:grid-cols-2 gap-4 mb-6">
            <div class="rounded-2xl border border-white/10 bg-black/40 p-4">
              <p class="text-xs uppercase tracking-wide text-gray-400">Ore risparmiate / mese</p>
              <p id="savedHours" class="text-2xl font-bold mt-2">0 h</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-black/40 p-4">
              <p class="text-xs uppercase tracking-wide text-gray-400">Risparmio economico lordo / mese</p>
              <p id="grossSaving" class="text-2xl font-bold mt-2">â‚¬ 0</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-black/40 p-4">
              <p class="text-xs uppercase tracking-wide text-gray-400">Beneficio netto / mese</p>
              <p id="netMonthly" class="text-2xl font-bold mt-2">â‚¬ 0</p>
            </div>
            <div class="rounded-2xl border border-white/10 bg-black/40 p-4">
              <p class="text-xs uppercase tracking-wide text-gray-400">Beneficio netto / anno</p>
              <p id="netYearly" class="text-2xl font-bold mt-2">â‚¬ 0</p>
            </div>
          </div>

          <div class="space-y-4">
            <div class="rounded-2xl border border-indigo-400/30 bg-indigo-500/10 p-5">
              <p class="text-xs uppercase tracking-wide text-indigo-200">ROI mensile</p>
              <p id="roiMonthly" class="text-3xl font-bold text-indigo-100 mt-2">0%</p>
            </div>
            <div class="rounded-2xl border border-orange-400/30 bg-orange-500/10 p-5">
              <p class="text-xs uppercase tracking-wide text-orange-100">Payback avvio</p>
              <p id="payback" class="text-3xl font-bold text-orange-100 mt-2">â€”</p>
            </div>
          </div>

          <p class="text-sm text-gray-400 mt-6">
            Il calcolo Ã¨ una stima basata sui parametri inseriti. Per una valutazione completa, integra costi indiretti, tempi amministrativi e crescita dei volumi.
          </p>
        </article>
      </div>
    </section>

    <section class="py-14 md:py-20 px-6 md:px-12 border-b border-white/5">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl md:text-4xl font-bold mb-8 text-center">Moduli principali del gestionale professionale</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Dashboard gestionale</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Gestione rapportini</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Ricerca e filtri avanzati</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Esportazione PDF</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Gestione utenti e ruoli (Admin/Operatore)</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Statistiche Admin</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Persistenza dati su Supabase</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Dark mode operativa</div>
          <div class="rounded-2xl border border-white/10 bg-white/[0.02] p-4">Storico interventi tracciabile</div>
        </div>
      </div>
    </section>

    <section class="py-16 px-6 md:px-12">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Vuoi una stima su dati reali aziendali?</h2>
        <p class="text-gray-300 mb-8">
          Possiamo configurare insieme il modello ROI su clienti, SLA, tipologia impianti e struttura del tuo team tecnico.
        </p>
        <a href="/contattaci" class="inline-flex items-center justify-center px-8 py-4 bg-white text-black rounded-full font-bold text-lg hover:scale-105 transition-transform">
          Richiedi analisi dedicata
        </a>
      </div>
    </section>

    <script>
      const initRoiCalculator = () => {
        const container = document.querySelector('main');
        if (!container || container.getAttribute('data-roi-init') === 'true') {
          return;
        }
        container.setAttribute('data-roi-init', 'true');

        const ids = [
          'reportsPerMonth',
          'operators',
          'avgInterventionsPerDay',
          'timeCurrent',
          'timeWithSoftware',
          'hourlyCost',
          'softwareMonthly',
          'setupCost',
        ];

        const getValue = (id: string): number => {
          const element = document.getElementById(id) as HTMLInputElement | null;
          const value = Number(element?.value ?? 0);
          return Number.isFinite(value) ? value : 0;
        };

        const currency = new Intl.NumberFormat('it-IT', {
          style: 'currency',
          currency: 'EUR',
          maximumFractionDigits: 0,
        });

        const decimal = new Intl.NumberFormat('it-IT', {
          minimumFractionDigits: 1,
          maximumFractionDigits: 1,
        });

        const write = (id: string, value: string) => {
          const el = document.getElementById(id);
          if (el) el.textContent = value;
        };

        const updateReportsFromTeam = () => {
          const operators = Math.max(1, getValue('operators'));
          const avgInterventionsPerDay = Math.max(0, getValue('avgInterventionsPerDay'));
          const workingDaysPerMonth = 22;
          const calculatedReports = Math.max(1, Math.round(operators * avgInterventionsPerDay * workingDaysPerMonth));

          const reportsInput = document.getElementById('reportsPerMonth') as HTMLInputElement | null;
          if (reportsInput) {
            reportsInput.value = String(calculatedReports);
          }
        };

        const calculate = () => {
          const reportsPerMonth = getValue('reportsPerMonth');
          const operators = Math.max(1, getValue('operators'));
          const timeCurrent = getValue('timeCurrent');
          const timeWithSoftware = getValue('timeWithSoftware');
          const hourlyCost = getValue('hourlyCost');
          const softwareMonthly = getValue('softwareMonthly');
          const setupCost = getValue('setupCost');

          const minutesSaved = Math.max(0, timeCurrent - timeWithSoftware);
          const savedHoursMonthly = (reportsPerMonth * minutesSaved) / 60;
          const grossSavingMonthly = savedHoursMonthly * hourlyCost;
          const netMonthly = grossSavingMonthly - softwareMonthly;
          const netYearly = netMonthly * 12;

          const roiMonthly = softwareMonthly > 0
            ? ((grossSavingMonthly - softwareMonthly) / softwareMonthly) * 100
            : 0;

          const paybackMonths = netMonthly > 0 && setupCost > 0
            ? setupCost / netMonthly
            : null;

          write('savedHours', `${decimal.format(savedHoursMonthly)} h`);
          write('grossSaving', currency.format(grossSavingMonthly));
          write('netMonthly', currency.format(netMonthly));
          write('netYearly', currency.format(netYearly));
          write('roiMonthly', `${decimal.format(roiMonthly)}%`);

          if (paybackMonths === null) {
            write('payback', 'Non calcolabile');
          } else if (paybackMonths < 1) {
            write('payback', '< 1 mese');
          } else {
            write('payback', `${decimal.format(paybackMonths)} mesi`);
          }

          const perOperator = savedHoursMonthly / operators;
          const paybackNode = document.getElementById('savedHours');
          if (paybackNode) {
            paybackNode.setAttribute('title', `Media per operatore: ${decimal.format(perOperator)} h/mese`);
          }
        };

        const operatorsInput = document.getElementById('operators') as HTMLInputElement | null;
        const avgInterventionsInput = document.getElementById('avgInterventionsPerDay') as HTMLInputElement | null;

        const onTeamInputsChanged = () => {
          updateReportsFromTeam();
          calculate();
        };

        operatorsInput?.addEventListener('input', onTeamInputsChanged);
        operatorsInput?.addEventListener('change', onTeamInputsChanged);
        avgInterventionsInput?.addEventListener('input', onTeamInputsChanged);
        avgInterventionsInput?.addEventListener('change', onTeamInputsChanged);

        ids
          .filter((id) => id !== 'operators' && id !== 'avgInterventionsPerDay')
          .forEach((id) => {
            const node = document.getElementById(id) as HTMLInputElement | null;
            node?.addEventListener('input', calculate);
            node?.addEventListener('change', calculate);
          });

        updateReportsFromTeam();
        calculate();
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initRoiCalculator);
      } else {
        initRoiCalculator();
      }

      document.addEventListener('astro:page-load', initRoiCalculator);
    </script>
  </main>
</Layout>
