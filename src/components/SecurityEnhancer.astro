---
// Componente per la gestione delle politiche di sicurezza e compatibilit√†
---

<!-- Nonce per CSP inline scripts (opzionale per maggiore sicurezza) -->
<script is:inline>
  // Security enhancements
  (function() {
    'use strict';
    
    // Prevent clickjacking
    if (self !== top) {
      top.location = self.location;
    }
    
    // Enhanced security for forms
    document.addEventListener('DOMContentLoaded', function() {
      // Add CSRF protection to forms if needed
      const forms = document.querySelectorAll('form');
      forms.forEach(form => {
        if (!form.querySelector('input[name="csrf_token"]')) {
          // Add CSRF token if implementing server-side validation
        }
      });
      
      // Sanitize user inputs
      const inputs = document.querySelectorAll('input[type="text"], input[type="email"], textarea');
      inputs.forEach(input => {
        input.addEventListener('input', function(e) {
          // Basic XSS prevention
          const value = e.target.value;
          if (/<script|javascript:|data:|vbscript:/i.test(value)) {
            e.target.value = value.replace(/<script|javascript:|data:|vbscript:/gi, '');
          }
        });
      });
    });
    
    // Enhanced error handling
    window.addEventListener('error', function(e) {
      // Log errors securely without exposing sensitive information
      console.error('Error caught:', e.error?.message || 'Unknown error');
    });
    
    // Secure external links
    document.addEventListener('click', function(e) {
      const link = e.target.closest('a[href^="http"]');
      if (link && !link.href.includes(window.location.hostname)) {
        link.setAttribute('rel', 'noopener noreferrer');
        link.setAttribute('target', '_blank');
      }
    });
  })();
</script>

<!-- Polyfills for older browsers -->
<script is:inline>
  // Intersection Observer polyfill check
  if (!('IntersectionObserver' in window)) {
    const script = document.createElement('script');
    script.src = 'https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver';
    document.head.appendChild(script);
  }
  
  // CSS custom properties support check
  if (!CSS.supports('color', 'var(--fake-var)')) {
    document.documentElement.className += ' no-css-vars';
  }
</script>

<style>
  /* Fallbacks for browsers without CSS custom properties */
  .no-css-vars {
    /* Fallback styles if needed */
  }
  
  /* Enhanced focus indicators for accessibility */
  .enhanced-focus:focus-visible {
    outline: 3px solid #005fcc;
    outline-offset: 2px;
    box-shadow: 0 0 0 6px rgba(0, 95, 204, 0.2);
  }
  
  /* Reduced motion respect */
  @media (prefers-reduced-motion: reduce) {
    .motion-safe {
      animation: none !important;
      transition: none !important;
    }
  }
</style>
