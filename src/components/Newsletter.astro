---
// Newsletter component with basic functionality
---

<div class="bg-blue-600 dark:bg-blue-800 text-white rounded-2xl p-8 text-center" id="newsletter-section">
  <h3 class="text-2xl font-bold mb-4">Rimani Aggiornato sulle Novità Digitali</h3>
  <p class="mb-6 opacity-90">
    Ricevi consigli settimanali su web design, SEO locale e tecnologie innovative per la tua azienda di Carmagnola.
  </p>
  
  <form id="newsletter-form" class="flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto">
    <input 
      type="email" 
      id="newsletter-email"
      placeholder="La tua email"
      required
      class="px-4 py-3 rounded-lg text-gray-900 dark:text-white flex-1 focus:outline-none focus:ring-2 focus:ring-blue-300"
    />
    <button 
      type="submit"
      id="newsletter-btn"
      class="bg-white dark:bg-gray-900 text-blue-600 hover:bg-gray-100 dark:bg-gray-700 px-6 py-3 rounded-lg font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-blue-300"
    >
      Iscriviti
    </button>
  </form>
  
  <div id="newsletter-message" class="mt-4 text-sm opacity-0 transition-opacity duration-300"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('newsletter-form') as HTMLFormElement;
    const emailInput = document.getElementById('newsletter-email') as HTMLInputElement;
    const submitBtn = document.getElementById('newsletter-btn') as HTMLButtonElement;
    const messageDiv = document.getElementById('newsletter-message') as HTMLDivElement;

    if (form && emailInput && submitBtn && messageDiv) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = emailInput.value.trim();
        
        if (!email || !isValidEmail(email)) {
          showMessage('Inserisci un indirizzo email valido', 'error');
          return;
        }

        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.textContent = 'Iscrizione...';

        try {
          // Simulate API call - replace with actual newsletter service
          await simulateNewsletterSignup(email);
          
          showMessage('Iscrizione completata! Controlla la tua email.', 'success');
          emailInput.value = '';
            // Track event for analytics
          if (typeof window.gtag !== 'undefined') {
            window.gtag('event', 'newsletter_signup', {
              'event_category': 'engagement',
              'event_label': 'blog_newsletter'
            });
          }
          
        } catch (error) {
          showMessage('Errore durante l\'iscrizione. Riprova più tardi.', 'error');
          console.error('Newsletter signup error:', error);
        } finally {
          // Re-enable button
          submitBtn.disabled = false;
          submitBtn.textContent = 'Iscriviti';
        }
      });
    }

    function isValidEmail(email: string): boolean {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function showMessage(message: string, type: 'success' | 'error') {
      if (messageDiv) {
        messageDiv.textContent = message;
        messageDiv.className = `mt-4 text-sm transition-opacity duration-300 opacity-100 ${
          type === 'success' ? 'text-green-200' : 'text-red-200'
        }`;
        
        // Hide message after 5 seconds
        setTimeout(() => {
          messageDiv.classList.add('opacity-0');
        }, 5000);
      }
    }

    async function simulateNewsletterSignup(email: string): Promise<void> {
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      // In a real implementation, this would call your newsletter service
      // For now, we'll just store it locally and log it
      const subscribers = JSON.parse(localStorage.getItem('newsletter_subscribers') || '[]');
      
      if (!subscribers.includes(email)) {
        subscribers.push(email);
        localStorage.setItem('newsletter_subscribers', JSON.stringify(subscribers));
        console.log('Newsletter signup:', email);
      }
      
      // You can integrate with services like:
      // - Mailchimp API
      // - ConvertKit API  
      // - EmailJS
      // - Your own backend API
    }
  });
</script>
